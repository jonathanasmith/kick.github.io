<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
  <link rel="manifest" href="favicon/site.webmanifest">
  <link rel="mask-icon" href="favicon/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  
  <title>Home</title>
  <link href="css/default.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
</head>
<body>

  <header class="B_i F_1 flexCell_v">
    <div class="FR " style="max-width:900px;">
      <div class="F_1 flexCell_v"></div>
      <div class="F_1 flexCell_v"><img src="images/logo_white.png" class="H_50"/></div>
      <div class="F_1 flexCell_v"></div> 
    </div>
  </header>

<!-- Start of Main content ******************************************************************************** -->

  <div class="flexCell_v">
    <div style="max-width:800px;margin:auto">
      <div id="frontPage" class="FC">
        <span id="deleteNotice"></span>
        
        <!-- Connect ******************************************************************************** -->

        <div id="connect" class="flexCell_v">
          <div class="M_L_50 M_R_50 FC">
            <div class="H_50"></div>
            <div class="F_1 h3 TA_C">Welcome to Kick.run, we're updating the site and we'll be back soon!</div>
            <div class="H_20"></div>
          </div>
          <div class="H_20"></div>
          <div id="demo" class="FR fade">
            <div id="demoContent" class="F_1 behind productContainer">
              <div class="BI_iv H_10 M_L_20 M_R_20"></div>
              <div class="H_30"></div>
              <div class="FR">
                <div class="F_1 flexCell_v">
                  <img src="images/top1.png" class="demoImage"/>
                  <div class="H_20"></div>
                </div>
                <div class="F_1 flexCell_v">
                  <img src="images/top2.png" class="demoImage"/>
                  <div class="H_20"></div>
                </div>
                <div class="F_1 flexCell_v">
                  <img src="images/top3.png" class="demoImage"/>
                  <div class="H_20"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>
  </div>

  <footer class="F_1 B_i FR H_75">
    <div class="footerContainer FR H_75 ">
      <div class="F_1 flexCell_iv M_L_20">&copy; Runwithkick Limited 2018</div>
      <div class="F_1 flexCell_v">
      </div>
      <div class="F_1 FR AI_C JC_E h2 P_R_20">
        <a href="https://facebook.com/groups/runwithkick" class="noStyle" target="_blank"><i class="fab fa-facebook-square"></i></a>&nbsp;&nbsp;
        <a href="https://twitter.com/runwithkick" class="noStyle" target="_blank"><i class="fab fa-twitter-square"></i></a>&nbsp;&nbsp;
        <a href="https://instagram.com/runwithkick" class="noStyle" target="_blank"><i class="fab fa-instagram"></i></a>
      </div>
    </div>
  </footer>
</body>
</html>

<script src="https://npmcdn.com/parse@1.11.1/dist/parse.js"></script>
<script src="JS/main.js"></script>

<script>


var accessTokenURL = getQueryVariable("accesstoken")
var accessTokenCookie = getCookie("accesstoken")

if(accessTokenCookie.length>0){
  storeLocal('accessToken',accessTokenCookie);
  var accessToken = localStorage.getItem("accessToken");
}

else if(accessTokenURL.length>0){
  storeLocal('accessToken',accessTokenURL);
  var accessToken = localStorage.getItem("accessToken");
  document.cookie = "accesstoken="+accessToken+";max-age=2678400; path=/"
}

else{
var accessToken = ""
}


if(accessToken.length>0){

startParse();

Parse.Cloud.run('retrieveUser', {
  AccessToken: accessToken
  }, {
  success: function(result) {

    if (result.activeUser == false) {
      document.getElementById("deleteNotice").innerHTML = '<div onclick="reconnect()" class="active FR H_75 flexCell_v TA_C B_iv BoR_10_B">Your account has been queued for deletion and will be removed during the next 24 hours. <span class="FW_500">Please click here to undo this action now.</span></div>'
    }

    //document.getElementById("firstNameConnecting").innerHTML = result.tokenResponse.athlete.firstname
    document.getElementById("firstName").innerHTML = result.tokenResponse.athlete.firstname
    
    if (result.firstSweep == false){

      document.getElementById('settingUp').style.display = "none";
      document.getElementById('activityHistory').style.display = "block";

      Parse.Cloud.run('StravaTempActivities', {
        Accesstoken: result.username,
      }, {
        success: function(result) {
          var distances = [];
          for(j = 0; j<4; j++){
            var result1 = result[j].data;
            for (i = 0; i < result1.length; i++){
              if(result1[i].type == "Run"){
                var resultsloop = result1[i].distance;
                distances.push(resultsloop) 
              }
            }
          }
          var maxDistance = Math.max(...distances)

          if(maxDistance >= 4950 && maxDistance < 9900){
            var tops = [true, false, false, false, false ] 
            updateUser(accessToken,"tops",tops);
            updateUser(accessToken,"firstSweep",true);
          }

          else if(maxDistance >= 9900 && maxDistance < 20950){
            var tops = [true, true, false, false, false ] 
            updateUser(accessToken,"tops",tops);
            updateUser(accessToken,"firstSweep",true);
          }

          else if(maxDistance >= 20950 && maxDistance < 42000){
            var tops = [true, true, true, false, false ] 
            updateUser(accessToken,"tops",tops);
            updateUser(accessToken,"firstSweep",true);
          }

          else if(maxDistance >= 42000 && maxDistance < 50000){
            var tops = [true, true, true, true, false ] 
            updateUser(accessToken,"tops",tops);
            updateUser(accessToken,"firstSweep",true);
          }

          else if(maxDistance >= 50000){
            var tops = [true, true, true, true, true ] 
            updateUser(accessToken,"tops",tops);
            updateUser(accessToken,"firstSweep",true);
          }

          else{
            var tops = [false, false, false, false, false ] 
            updateUser(accessToken,"tops",tops);
            updateUser(accessToken,"firstSweep",true);
          }

          document.getElementById('loading').style.display = "none";
          document.getElementById('connected').style.display = "block";
          document.getElementById('accountSettings').style.display = "block";

          for (i = 0; i < tops.length; i++){
            
            if(tops[i]){
                var topNumber = i+1
                var topNumberString =topNumber.toString();
                var element = document.getElementById(topNumberString);
                element.classList.remove("disable");
                var element1 = document.getElementById("topUnlock"+topNumberString);
                element1.classList.remove("fa-lock");
                element1.classList.add("fa-check");
            }
          };
        },
        error: function(error) {
          alert("Error retrieving activities, please refresh & contact hello@kick.run if the problem persists")
        }
      });
    }

    else{
      document.getElementById('loading').style.display = "none";
      document.getElementById('connected').style.display = "block";
      document.getElementById('accountSettings').style.display = "block";

      var tops = result.tops
      for (i = 0; i < tops.length; i++){
        
        if(tops[i]){
            var topNumber = i+1
            var topNumberString =topNumber.toString();
            var element = document.getElementById(topNumberString);
            element.classList.remove("disable");
            var element1 = document.getElementById("topUnlock"+topNumberString);
            element1.classList.remove("fa-lock");
            element1.classList.add("fa-check");
        }
      };
    }


    var notifications = result.notifications

    if (notifications){
      document.getElementById('notifications1').style.display = "inline";
    }
    else{
      document.getElementById('notifications2').style.display = "inline";
    }

    var preferences = result.updates
    if (preferences){
      document.getElementById('preferences1').style.display = "inline";
    }
    else{
      document.getElementById('preferences2').style.display = "inline";
    }

  },
  error: function(error){ 
  document.getElementById('loading').style.display = "none";
  document.getElementById('connect').style.display = "flex";
  }
});
}

else  {
  document.getElementById('loading').style.display = "none";
  document.getElementById('connect').style.display = "flex";
}


</script>
